# TerraForger 次期開発ロードマップ

---

## 1. 敵（スライム/ウサギ）＋ドロップ（油/生肉）＋弓矢（遠距離）

### 目的（プレイ体験）
- 夜や探索に緊張感が出る
- クラフト素材（油/生肉）が手に入り、次工程のクラフトが成立する
- ウサギ（逃走）を狩れるようになり、食料ループの入口ができる

### 実装する内容（MVP）
- 敵エンティティ基盤
  - 位置/速度/サイズ(AABB)/HP/状態（alive, dead）
  - update（移動・AI）/draw（描画）/hit判定（被ダメ）
- スライム
  - プレイヤーを追尾（一定距離で接近 or ジャンプで寄る）
  - 接触でダメージ
- ウサギ（非敵対）
  - 逃げAI（プレイヤーから距離を取る）※徘徊でも可
  - 攻撃はしない
- ドロップ
  - スライム撃破 → 油
  - ウサギ撃破 → 生肉
  - ドロップはワールド上に落ち、拾うとインベントリに入る
- 弓矢（遠距離攻撃）
  - 弓（装備）＋矢（消耗アイテム/弾薬）
  - マウス方向へ直線弾（重力なし）を発射
  - 射程/連射/弾薬で強さを制御

### 仕様として決めるべきこと（重要）
- スポーン条件
  - 出現場所：地上のみ / 地上＋地下
  - 出現時間：昼夜どちら / 夜のみ（推奨：スライムは夜寄り、ウサギは昼寄り）
  - 最大同時数・湧き間隔
- 戦闘ルール
  - プレイヤーHP/被ダメ時の無敵時間（例：0.5〜1.0秒）
  - ノックバックの有無（推奨：あり。最小でOK）
  - 武器/ツールの攻撃判定（リーチ・角度・攻撃間隔）
- ドロップルール
  - 落下物理：重力あり/なし（推奨：あり）
  - 拾える距離・吸い寄せ（任意）
  - 同種アイテムのマージ（同じ場所で合体）/寿命（任意）
- 弓矢ルール
  - 矢の消費：1発=矢-1（スタック可）
  - 弾の方式：直線弾、壁/敵衝突で消滅
  - パラメータ：射程（例：12タイル）/連射CD（例：0.5秒）/ダメージ
  - 矢のクラフト：序盤で詰まらない材料（例：枝+石→矢×10 など）
- バランス初期値（仮でOK）
  - スライムHP/攻撃力、ウサギHP、逃走速度
  - ドロップ率：最初は100%で良い（調整は後）
  - 弓：安全だが近接よりDPS低め、矢コストあり

### 完了条件
- 敵が湧く→倒せる→油/生肉が落ちる→拾って所持できる
- 弓矢で遠距離攻撃でき、逃げるウサギを狩れる

---

## 2. 作業台クラフト（たいまつ/焚火）＋焚火調理（焼肉）

### 目的（プレイ体験）
- 油/生肉に使い道ができる
- 「光源」「食料（備蓄）」の基本ループが回り始める

### 実装する内容（MVP）
- 作業台レシピ追加
  - 枝×1 + 油×1 → たいまつ
  - 木×1 + 油×1 → 焚火（設置物）
- 焚火の機能（調理）
  - 焚火に近づいてインタラクト（Eなど）で調理UI
  - 生肉×1 → 焼肉×1
- アイテム定義
  - たいまつ（設置物）
  - 焚火（設置物）
  - 生肉（食料：Food値あり）
  - 焼肉（食料：Food値あり、効率が高い）

### 仕様として決めるべきこと（重要）
- たいまつ/焚火の扱い
  - placeableとして設置する（推奨：placeablesで統一）
  - 設置制限：空気マスのみ / 壁にも置ける（後回しでOK）
- 焚火の調理UI
  - ポップアップ（小）でOK（×1/×5/×10は任意）
- 食料アイテムのFood値（例）
  - 生肉=5、焼肉=20（仮。後で調整）
- バランス初期値（仮）
  - たいまつ作成コスト（枝/油の供給量に合わせて調整）
  - 焚火のコスト（木/油）

### 完了条件
- 油でたいまつ/焚火が作れる
- 焚火で生肉→焼肉が作れる
- 生肉/焼肉が「食料（Food値）」として備蓄できる

---

## 3. 暗闇＋光源（夜/地下の体験を変える）

### 目的（プレイ体験）
- 夜や地下が「準備して挑む場所」になる
- たいまつ/焚火が必需品になる

### 実装する内容（MVP）
- 明るさレイヤ
  - 昼：地上は明るい
  - 夜：地上は薄暗い（見えるが不安）
  - 地下：真っ暗（基本何も見えない）
- 光源（たいまつ/焚火）
  - 設置した場所を中心に周囲を照らす
  - たいまつ < 焚火（照射半径/明るさ）
- 実装方式（推奨：簡易）
  - 画面全体に暗いオーバーレイ
  - 光源位置に円形の「抜き」を合成して明るく見せる（複数光源対応）

### 仕様として決めるべきこと（重要）
- 地下「完全に見えない」の救済
  - 推奨：プレイヤー周囲だけごく弱い視界を残す（ストレス低減）
- 地上/地下判定
  - 例：そのx列の地表yより下は地下扱い
  - 洞窟内（空洞）も地下扱い（推奨）
- 光源のパラメータ
  - 半径（たいまつ：小、焚火：中〜大）
  - 明るさ（中心明るい→外側減衰）
  - 同時に存在できる数（無制限でもOKだが負荷注意）
- 将来拡張（今は決めなくてOK）
  - 燃料消費（油で補給）、煙、風で消える 等

### 完了条件
- 夜になると地上が暗くなる
- 地下はかなり暗い（たいまつ必須に近い）
- たいまつ/焚火を置くと周囲が明るくなる

---

## 4. Food（拠点備蓄）システム（6:00日次消費）＋ペナルティ（猶予1日）

### 目的（プレイ体験）
- 食料を確保する“生活”が生まれる（サバイバル要素）
- NPC増員の意味が出る（人数が増えるほど食料が必要）

### 実装する内容（MVP）
- 拠点チェスト（Base Chest）
  - チェストに `isBaseChest` フラグ（UIで切替）
- 日次消費（6:00）
  - `dailyNeed = population * foodPerPersonPerDay`（例：10/人/日）
  - Base Chest内の食料アイテムを集計し、必要量を消費
  - 消費順：Food値が小さいもの→優先
- UI（左カラム）
  - `Food: X.X days`（daysRemaining = totalFood / dailyNeed）
  - 警告表示（不足時）

### 仕様として決めるべきこと（重要）
- 人口の定義
  - `population = 1 + livingNPCCount`（プレイヤー+生存NPC）
- 食料不足時の状態遷移
  - `starveDays=1`：猶予（警告のみ）
  - `starveDays>=2`：デバフ発動＋NPCが倒れる（機能停止）
- デバフ内容（初期案）
  - プレイヤー：ATK/DEF低下（例：-25%）
  - NPC：`isDown=true`（機能提供しない）
- 回復
  - 次の6:00で必要量を満たせば `starveDays=0` に戻り、NPCも復帰（即時復帰）

### 完了条件
- Base Chestの指定ができる
- 6:00で日次消費され、`Food: X.X days` が正しく表示される
- 食料不足→猶予→デバフ＋NPCダウンが発動し、回復条件で復帰する

---

## 5. セーブ&ロード＋タイトル（Food/NPC/時刻も含めて永続化）

### 目的（プレイ体験）
- 作った拠点・集めた資源・時間経過が保存され、継続プレイできる
- Food日次消費や木/草成長を含む“生活”が積み上がる

### 実装する内容（MVP）
- タイトル画面
  - 「はじめから」：新規ワールド生成
  - 「続きから」：セーブがあればロード、なければ無効/グレー
- 保存先
  - localStorage（ブラウザキャッシュ）
- 保存対象（優先順）
  1) ワールド生成seed
  2) ワールド変更差分（壊した/置いたタイル、設置物）
  3) プレイヤー（位置、HP、装備、インベントリ）
  4) チェスト内容（Base Chestフラグ含む）
  5) 時刻・日数（6:00成長/消費と整合のため必須）
  6) Food関連（starveDays、人口/NPC状態）
  7) NPC（位置/状態/機能の解放状況 ※導入後）

### 仕様として決めるべきこと（重要）
- セーブ粒度
  - 推奨：自動（数十秒）＋重要イベント（6:00）＋手動（任意）
- 保存データ形式
  - `version` を必ず入れる
  - 差分保存（deltaTiles）を基本にする
- リカバリ
  - セーブ破損時は新規開始にフォールバック

### 完了条件
- タイトルで開始/続きが選べる
- リロードしても状態が復元される
- 時刻・日数・Food日次消費・木/草成長が破綻しない

---

## 6. 鉱物拡張＋強敵（進行/装備強化）

### 目的（プレイ体験）
- 探索に「深く潜る意味」が生まれる
- 装備強化が進行の軸になる（RPG/サバイバル感が増す）

### 実装する内容（MVP）
- 鉱石の追加
  - 例：銅/銀/金/ダイヤ（現状に合わせて選択）
  - 深度による出現率テーブル
- 精錬・加工
  - かまど（精錬設備）導入
  - 鉱石 → インゴット
- 装備強化
  - ツールTier/武器ATK/防具DEFの段階強化
  - レシピを進行に合わせて解放
- 強敵
  - 深部専用の敵（例：洞窟スライム、アーマード系）
  - 夜/深度/POIでスポーンを切り替え

### 仕様として決めるべきこと（重要）
- 進行ゲート設計
  - ツールTierが足りないと掘れない鉱石を設定
  - 強敵は「強い装備がないと厳しい」位置に配置
- バランス
  - 鉱石の必要数（装備1式に必要なインゴット量）
  - 敵の強さ曲線（昼の地上 < 夜の地上 < 地下浅層 < 深層）
- 資源枯渇との整合
  - 鉱物は有限で良いか、再生成イベントを入れるか（後で検討でもOK）

### 完了条件
- 地下を掘る→鉱石→精錬→強化のループが回る
- 深部に行くほど報酬と危険が増える

---
