# 要求仕様書（RequirementsSpecification.md）

## 設置物のデータ化（複数マス対応の開発計画）

### 目的
- 扉のような縦2マス、横2マス、縦4マスなどの設置物を共通ロジックで扱えるようにする
- 設置判定・描画・回収・当たり判定をサイズに依存しない構造へ整理する

### 開発ステップ
1. **設置物定義の拡張（state.js）**
   - `PlaceableDefs` に以下の情報を追加する
     - `size: { w, h }`（占有するタイル数）
     - `origin: { x, y }`（クリックしたタイルを基準にした原点）
     - `sprites: [{ dx, dy, index }]`（描画するスプライトと貼り付け位置）
     - `iconSprites` と `iconScale`（所持欄表示用の縮小合成設定）

2. **占有タイルの共通計算関数を追加（world.js もしくは util）**
   - `getPlaceableTiles(def, baseCol, baseRow)` を追加する
   - `size` と `origin` から、実際に占有するタイル一覧を返す

3. **設置判定を共通化（input.js）**
   - 占有タイル全てが「空気」かつ「設置物未配置」であることを確認する
   - プレイヤーと重なるタイルがあれば設置不可
   - 木の壁など背景設置物は「前景と重ねられる」ルールを別判定で持つ

4. **回収判定を共通化（input.js / world.js）**
   - クリック位置から設置物を特定し、占有タイルごとの特例分岐をなくす
   - 前景優先 → 背景（木の壁）という回収順を維持する

5. **描画処理の共通化（render.js）**
   - `sprites` の配列をループして描画する
   - 扉などの上下2マス描画を特例扱いせず、定義情報で処理する

6. **UI表示の共通化（ui.js）**
   - `iconSprites` と `iconScale` を使い、所持欄のアイコンを合成表示する
   - 扉のような縦長アイコンも同じ仕組みで表現する

7. **既存設置物の移行**
   - 収納箱 / 作業机 / 梯子 / 木の壁 / 木の扉を新しい定義形式に移行する
   - 破壊・回収・設置・描画が同じ仕組みで動くことを確認する

8. **動作確認**
   - サイズが異なる設置物でも設置できるか
   - 2マス以上の設置物が正しく描画されるか
   - 重なり順（木の壁 → 前景設置物 → プレイヤー/ブロック）が維持されるか